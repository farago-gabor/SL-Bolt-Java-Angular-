Nagyon j√≥ alap! A **backend** implement√°ci√≥dat logikailag rendben van, de **a jelenlegi k√≥d nem tudja k√ºl√∂n kezelni ugyanannak a tev√©kenys√©gnek a t√∂bb napi id≈ëpontj√°t** (pl. reggel 6 √©s d√©lut√°n 14 √≥ra), mert a napl√≥z√°s (`feladatElvegzese`) csak a `tevekenyseg_id`-t napl√≥zza, √©s nem az adott id≈ëpontot.

Ez√©rt hi√°ba van t√∂bb `TevekenysegIdopont` egy tev√©kenys√©ghez, ha az egyiket elv√©gzi a dolgoz√≥, a rendszer m√°r ‚Äûelv√©gezve‚Äù-nek l√°tja az eg√©szet ‚Äî teh√°t nem tudja megk√ºl√∂nb√∂ztetni a reggeli √©s d√©lut√°ni feladatot.

---

## ‚úÖ Teend≈ëk, hogy j√≥l m≈±k√∂dj√∂n a t√∂bbsz√∂ri napi v√©grehajt√°s

### 1Ô∏è‚É£ Az adatb√°zist m√≥dos√≠tani kell kicsit

A `tevekenyseg_naplo` t√°bl√°ba vegy√©l fel egy `idopont_id` mez≈ët:

```sql
ALTER TABLE tevekenyseg_naplo
ADD COLUMN idopont_id INT NULL,
ADD CONSTRAINT fk_naplo_idopont FOREIGN KEY (idopont_id)
    REFERENCES tevekenyseg_idopontok(id)
    ON DELETE SET NULL;
```

---

### 2Ô∏è‚É£ Az entit√°st (`TevekenysegNaplo.java`) b≈ëv√≠tsd

```java
@ManyToOne
@JoinColumn(name = "idopont_id")
private TevekenysegIdopont idopont;
```

---

### 3Ô∏è‚É£ A repository-ban pontosabb lek√©rdez√©st haszn√°lj

Most ez van:

```java
boolean existsByTevekenysegAndDatum(Tevekenyseg tevekenyseg, LocalDate datum);
```

Ezt eg√©sz√≠tsd ki:

```java
boolean existsByTevekenysegAndIdopontAndDatum(Tevekenyseg tevekenyseg, TevekenysegIdopont idopont, LocalDate datum);
```

---

### 4Ô∏è‚É£ A service met√≥dust (`feladatElvegzese`) m√≥dos√≠tsd

Most:

```java
public void feladatElvegzese(int tevekenysegId, int dolgozoId, LocalDate datum)
```

Legyen:

```java
public void feladatElvegzese(int tevekenysegId, Integer idopontId, int dolgozoId, LocalDate datum)
```

√âs a tartalma:

```java
@Override
public void feladatElvegzese(int tevekenysegId, Integer idopontId, int dolgozoId, LocalDate datum) {
    Tevekenyseg tevekenyseg = tevekenysegRepository.findById(tevekenysegId)
            .orElseThrow(() -> new RuntimeException("Tev√©kenys√©g nem tal√°lhat√≥: " + tevekenysegId));

    Dolgozo dolgozo = dolgozoRepository.findById(dolgozoId)
            .orElseThrow(() -> new RuntimeException("Dolgoz√≥ nem tal√°lhat√≥: " + dolgozoId));

    TevekenysegIdopont idopont = null;
    if (idopontId != null) {
        idopont = gyakorisagRepository.findIdopontById(idopontId)
                .orElseThrow(() -> new RuntimeException("Id≈ëpont nem tal√°lhat√≥: " + idopontId));
    }

    boolean alreadyLogged = naploRepository.existsByTevekenysegAndIdopontAndDatum(tevekenyseg, idopont, datum);
    if (alreadyLogged) return;

    TevekenysegNaplo naplo = new TevekenysegNaplo();
    naplo.setTevekenyseg(tevekenyseg);
    naplo.setDolgozo(dolgozo);
    naplo.setDatum(datum);
    naplo.setMegcsinalta(true);
    naplo.setIdopont(idopont);

    naploRepository.save(naplo);
}
```

---

### 5Ô∏è‚É£ A frontend h√≠v√°sn√°l (Angular) az `elvegzes(t)` gombbal k√ºldd el az `idopont_id`-t is:

```ts
elvegzes(t) {
  this.http.post('/api/tevekenysegek/naplo', {
    tevekenysegId: t.id,
    idopontId: t.idopont?.id ?? null
  }).subscribe(() => this.frissit());
}
```

---

### 6Ô∏è‚É£ A backend controller endpoint (Spring REST) √≠gy n√©zzen ki:

```java
@PostMapping("/naplo")
public ResponseEntity<Void> elvegzes(@RequestBody FeladatElvegzesDTO dto) {
    tevekenysegService.feladatElvegzese(dto.getTevekenysegId(), dto.getIdopontId(), dto.getDolgozoId(), LocalDate.now());
    return ResponseEntity.ok().build();
}
```

DTO:

```java
@Data
public class FeladatElvegzesDTO {
    private int tevekenysegId;
    private Integer idopontId; // lehet null, ha "mindig" t√≠pus
    private int dolgozoId;
}
```

---

## üí° Eredm√©ny

| Tev√©kenys√©g | Id≈ëpont | D√°tum      | Dolgoz√≥    | Megcsin√°lta |
| ----------- | ------- | ---------- | ---------- | ----------- |
| Bolt nyit√°s | 06:00   | 2025-11-13 | Kiss P√©ter | ‚úÖ           |
| Bolt nyit√°s | 14:00   | 2025-11-13 | Kiss P√©ter | ‚úÖ           |

A rendszer most m√°r **ugyanazt a tev√©kenys√©get t√∂bbsz√∂r is engedi napl√≥zni egy napon bel√ºl**, de mindig k√ºl√∂n `idopont_id` szerint.

---

Szeretn√©d, hogy mutassak hozz√° egy **Spring Data JPA repository p√©ld√°t** is, ami tartalmazza az `existsByTevekenysegAndIdopontAndDatum` met√≥dust √©s a `findAllByDatum()` lek√©rdez√©st az √∫j szerkezethez?
